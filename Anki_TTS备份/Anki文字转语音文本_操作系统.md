# 操作系统
## 操作系统0003 操作系统的目标——向上层提供方便易用的服务
操作系统的主要目标之一是向上层提供方便易用的服务。它采用封装的思想，将一些复杂的硬件功能封装成简单易用的服务，使用户能更方便地使用计算机。用户无需关心底层硬件的原理，只需要对操作系统发出命令即可。
向上层提供的这些服务分为两类：直接给用户使用的服务和给软件或程序员使用的服务。直接给用户使用的服务包括图形用户界面（G U I）和命令接口。命令接口又分为联机命令接口和脱机命令接口。联机命令接口是用户说一句，系统做一句；脱机命令接口则是用户说一堆，系统做一堆。
给软件或程序员使用的服务主要是程序接口，即系统调用。用户通过程序接口间接使用操作系统提供的服务。

## 操作系统0006 并发
并发是指在同一时间间隔内发生两个或多个事件。这些事件在宏观上看似同时发生，但在微观上是交替发生的。常常容易混淆的概念是并行，并行是指两个或多个事件在同一时刻同时发生。
操作系统的并发性意味着计算机系统中有多个程序在“同时”运行，这些程序在宏观上看是同时运行的，但在微观上是交替运行的。操作系统是伴随着“多道程序技术”而出现的，因此，操作系统和程序并发是一起诞生的。
需要注意的是，单核CPU在同一时刻只能执行一个程序，各个程序只能并发地执行；而多核CPU在同一时刻可以同时执行多个程序，多个程序可以并行地执行。

## 操作系统0008  并发和共享的关系
并发和共享是计算机系统中密切相关的概念。并发性指的是系统中同时存在多个运行着的程序，这些程序可以在同一时刻执行不同的任务或操作。共享性则是指系统中的资源（如内存、文件、设备等）可以被多个并发执行的进程共同使用。
这两者是互为存在条件的：如果没有并发性，即系统只能同时运行一个程序，那么共享性就失去了意义，因为资源不需要被多个进程共享。反之，如果失去了共享性，即资源不能被多个进程共同使用，系统的资源利用效率可能会降低，因为每个进程可能需要独占一份资源，导致资源浪费和性能下降。
因此，并发性和共享性相辅相成，是确保计算机系统能够高效运行的重要条件之一。

## 操作系统0021 内核态、用户态的切换
内核态和用户态的切换过程。
当从内核态切换到用户态时，需要执行一条特权指令——这条指令会修改PSW的标志位为“用户态”。这个动作意味着操作系统将主动让出CPU的使用权。
而从用户态切换到内核态则是由“中断”引发的。硬件会自动完成这个切换过程，触发中断信号意味着操作系统将强行夺回CPU的使用权。
除了非法使用特权指令之外，还有很多事件也会触发中断信号。一个共同点是，只要需要操作系统介入的地方，都会触发中断信号。

## 操作系统0026 中断机制的基本原理
不同的中断信号，需要用不同的中断处理程序来处理。当CPU检测到中断信号后，会根据中断信号的类型去查询“中断向量表”，以此来找到相应的中断处理程序在内存中的存放位置。

## 操作系统0028 系统调用VS库函数——系统调用
系统调用VS库函数之系统调用的相关概念：
一、系统调用是操作系统提供给用户空间程序与操作系统内核间交互的接口。
二、它们通常提供了对底层硬件资源（如文件系统、网络、进程管理等）的访问。
三、系统调用由操作系统内核实现和维护，而且执行系统调用会导致用户空间程序的特权级别从用户态切换到内核态。

## 操作系统0034 系统调用的必须性：实现进程间通信
系统调用的必要性之一是实现进程间通信。在多进程或多线程的环境中，不同的进程或线程需要进行通信和协作。操作系统提供了各种机制来支持进程间通信，如管道、消息队列、共享内存等，而这些机制通常需要通过系统调用来完成。

## 操作系统0042 系统调用的过程：执行系统调用服务例程
系统调用的过程之：执行系统调用服务例程。当处理器处于内核态时，操作系统内核会根据系统调用号确定需要执行的系统调用服务例程。系统调用服务例程是操作系统内核中实现特定系统调用功能的代码段。操作系统内核会根据系统调用请求中的参数执行相应的操作，例如打开文件、读取数据等。

## 操作系统0045 系统调用的过程：总结
系统调用的过程可以总结如下：
系统调用的过程涉及以下几个关键步骤：首先，用户程序传递系统调用参数；接着，系统执行陷入指令，将控制从用户态切换到核心态；然后，在核心态下执行相应的内核程序来处理系统调用；最后，处理完成后返回结果给应用程序。这一过程是操作系统向用户程序提供服务的重要机制之一。

## 操作系统0051 原语
原语是一种特殊的程序，具有原子性，即操作要么全部执行，要么都不执行，执行期间不可中断。它位于操作系统的最底层，是最接近硬件的部分。原语的特点之一是运行时间较短，并且经常被频繁调用。

## 操作系统0053 微内核VS大内核
微内核与大内核在操作系统设计中有着显著的区别。微内核将操作系统的核心功能模块化，大部分系统服务和功能实现为用户空间的进程或服务。这种架构通过微内核提供的通信机制来实现模块间的交互，因而涉及相对频繁的CPU状态切换。
相反，大内核设计则倾向于将核心功能尽可能集成在内核中，使得这些功能在内核态直接运行，从而提高系统的整体性能。由于大部分功能在内核态运行，这种设计导致相对较少的CPU状态切换。
需要注意的是，CPU状态的切换是有一定成本的，因为它需要消耗时间。频繁地进行状态切换会降低系统的性能，因此在选择操作系统设计架构时，需权衡这些因素。

## 操作系统0054 分层结构
操作系统结构之：分层结构。
特性和思想：内核分为多层，最底层是硬件，最高层是用户接口。每一层可以单向调用更低一层提供的接口。
优点包括便于调试和验证，可以自底向上逐层进行调试和验证。扩充和维护也较为容易，因为各层之间调用的接口清晰且固定。
缺点是只能调用相邻的低层，难以合理定义各层的边界。效率低下，不能跨层调用，系统调用的执行时间较长。

## 操作系统0055 模块化结构

操作系统内核结构之模块化结构，这种设计将内核划分为主模块和可加载内核模块，并鼓励各模块之间进行协作。主模块专注于核心功能，如进程调度和内存管理；而可加载内核模块则允许动态添加新功能，而无需重新编译整个内核。
这种结构有几个显著的优点。首先，模块间的逻辑清晰，易于维护，只要确定了模块间的接口，就可以并行开发多个模块。其次，支持动态加载新的内核模块，例如安装设备驱动程序或者引入新的文件系统模块，从而增强操作系统的适应性。此外，模块之间可以直接调用，而无需采用消息传递机制，因此效率较高。
然而，这种模块化结构也存在一些缺点。例如，模块间的接口定义可能不合理或不实用，导致系统设计的复杂性。另外，模块之间可能会出现相互依赖，这增加了调试和验证的难度。

## 操作系统0058 操作系统引导（开机过程）
操作系统引导过程（即，开机过程）。
一、C P U从一个特定主存地址开始，取指令，执行R O M中的引导程序(先进行硬件自检，再开机)；
二、将磁盘的第一块主引导记录读入内存，执行磁盘引导程序，扫描分区表；
三、从活动分区(又称主分区，即安装了操作系统的分区)读入分区引导记录，执行其中的程序；
四、从根目录下找到完整的操作系统初始化程序（即启动管理器）并执行，完成“开机”的一系列动作；

## 操作系统0060 虚拟机的分类

虚拟机可分为两类，第一类V M M直接运行在硬件上  ；第二类V M M运行在宿主操作系统上。

在对物理资源的控制权上，第一类虚拟机直接运行在硬件之上，能直接控制和分配物理资源；第二类虚拟机则运行在主机操作系统之上，依赖于主机操作系统为其分配物理资源。

在资源分配方式上，第一类虚拟机在安装虚拟客户操作系统时，虚拟机管理程序要在原本的硬盘上自行分配存储空间，类似于外核的分配方式，分配未经抽象的物理硬件。第二类虚拟机的虚拟客户操作系统拥有自己的虚拟磁盘，该盘实际上是主机操作系统文件系统中的一个大文件。虚拟客户操作系统分配到的内存是虚拟内存。

在性能上，第一类虚拟机的性能更好。第二类虚拟机的性能更差，因为其需要主机操作系统作为“中介”。

在可支持的虚拟机数量上，第一类虚拟机可以支持更多的虚拟机，因为不需要和主机操作系统竞争资源，相同的硬件资源可以支持更多的虚拟机。第二类虚拟机可以支持的数量较少，因为主机操作系统本身需要使用物理资源，主机操作系统上运行的其他进程也需要物理资源。

在虚拟机的可迁移性上，第一类虚拟机的可迁移性较差。第二类虚拟机的可迁移性更好，只需导出虚拟机镜像文件即可迁移到另一台主机操作系统上，因此商业化应用更广泛。

在运行模式上，第一类虚拟机管理程序运行在最高特权（Ring 0）等级下，可以执行最高特权的指令。第二类虚拟机管理程序部分运行在用户态、部分运行在内核态。虚拟客户操作系统发出的系统调用会被虚拟机管理程序截获，并转化为虚拟机管理程序对主机操作系统的系统调用。

## 操作系统0062 进程的组成

进程由几个主要组成部分构成：

首先是PCB（进程控制块），它包含着进程的描述信息、进程的控制和管理信息、资源分配清单以及处理机相关信息。

其次是程序段，包括程序的代码（指令序列），描述了进程执行的操作和指令流程。

最后是数据段，存放运行过程中产生的各种数据，例如程序中定义的变量和其他数据。

这些组成部分共同定义了一个进程的结构和运行时所需的资源。

## 操作系统0064 PCB
进程控制块，简称PCB，包含几个重要部分。
首先是进程描述信息，包括进程标识符PID和用户标识符UID。接下来是进程控制和管理信息，这部分内容涵盖了CPU、磁盘、网络流量的使用情况统计以及进程当前状态，比如就绪态、阻塞态、运行态等。
另外还有资源分配清单，列出进程正在使用的文件、内存区域以及I/O设备。最后是处理机相关信息，例如P S W、P C等各种寄存器的值，这些信息用于实现进程切换。

## 操作系统0065 进程控制块PCB
进程控制块（PCB）

PCB是进程存在的唯一标志。当操作系统创建进程时，会为每个进程创建一个对应的PCB。当进程结束时，系统会回收其对应的PCB。

在进程创建时，操作系统会分配一个唯一且不重复的进程ID（PID），这可以看作是进程的“身份证号”。

PCB包含了操作系统对进程管理所需的所有信息。它记录了进程的当前状态、程序计数器、内存分配情况、调度信息、打开文件列表以及其他与进程相关的信息。操作系统通过访问和更新PCB来管理各个并发运行的进程。

## 操作系统0072 终止态
一个进程可以通过执行exit系统调用，请求操作系统终止它自己。这时候，该进程会进入“终止态”，操作系统会从CPU中移除该进程，并且回收它所占用的内存空间以及其他资源。最后，操作系统还会释放该进程的PCB（即，进程控制块），以便将其重新用于其他目的或者释放相应的系统资源。
